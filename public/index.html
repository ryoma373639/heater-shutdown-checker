<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="ç¯æ²¹ã‚¹ãƒˆãƒ¼ãƒ–ã®æ¶ˆç«ç¢ºèªã‚’ç®¡ç†ã™ã‚‹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³">
  <meta name="theme-color" content="#ef4444">
  <title>ç¯æ²¹ã‚¹ãƒˆãƒ¼ãƒ–æ¶ˆç«ç¢ºèªã‚¢ãƒ—ãƒª</title>
  <link rel="manifest" href="./manifest.json">
  <link rel="icon" type="image/png" sizes="192x192" href="./assets/icons/icon-192.png">
  <link rel="apple-touch-icon" href="./assets/icons/icon-192.png">

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
  <script src="./firebase-config.js"></script>

  <style>
    /* ============================================
       CSS Variables - Modern Color Palette
       ============================================ */
    :root {
      --primary-red: #f43f5e;
      --primary-red-dark: #e11d48;
      --primary-red-light: #fb7185;
      --accent-orange: #fb923c;
      --accent-yellow: #fbbf24;
      --success-green: #10b981;
      --success-green-dark: #059669;
      --info-blue: #3b82f6;
      --info-blue-light: #60a5fa;
      --gray-50: #f9fafb;
      --gray-100: #f3f4f6;
      --gray-200: #e5e7eb;
      --gray-300: #d1d5db;
      --gray-400: #9ca3af;
      --gray-500: #6b7280;
      --gray-600: #4b5563;
      --gray-700: #374151;
      --gray-800: #1f2937;
      --gray-900: #111827;

      --bg-gradient-start: #fff1f2;
      --bg-gradient-end: #ffe4e6;

      --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
      --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
      --shadow-md: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
      --shadow-lg: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
      --shadow-xl: 0 25px 50px -12px rgba(0, 0, 0, 0.25);

      --transition-fast: 150ms ease-in-out;
      --transition-normal: 300ms ease-in-out;
      --transition-slow: 500ms ease-in-out;
    }

    /* ============================================
       Reset & Base Styles
       ============================================ */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: linear-gradient(135deg, var(--bg-gradient-start) 0%, var(--bg-gradient-end) 100%);
      background-attachment: fixed;
      min-height: 100vh;
      padding: 16px;
      color: var(--gray-800);
      line-height: 1.6;
    }

    .container {
      max-width: 900px;
      margin: 0 auto;
    }

    /* ============================================
       Glassmorphism Cards
       ============================================ */
    .card {
      background: rgba(255, 255, 255, 0.85);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.3);
      border-radius: 16px;
      box-shadow: var(--shadow-md);
      padding: 20px;
      margin-bottom: 20px;
      transition: all var(--transition-normal);
    }

    .card:hover {
      box-shadow: var(--shadow-lg);
      transform: translateY(-2px);
    }

    /* ============================================
       Header Section
       ============================================ */
    .header {
      display: flex;
      align-items: center;
      gap: 16px;
      margin-bottom: 12px;
    }

    .icon-box {
      background: linear-gradient(135deg, var(--primary-red) 0%, var(--primary-red-dark) 100%);
      padding: 14px;
      border-radius: 12px;
      font-size: 24px;
      box-shadow: 0 4px 12px rgba(244, 63, 94, 0.3);
      animation: pulse-glow 2s ease-in-out infinite;
    }

    @keyframes pulse-glow {
      0%, 100% { box-shadow: 0 4px 12px rgba(244, 63, 94, 0.3); }
      50% { box-shadow: 0 4px 20px rgba(244, 63, 94, 0.5); }
    }

    h1 {
      font-size: 22px;
      color: var(--gray-900);
      font-weight: 700;
      letter-spacing: -0.5px;
    }

    .subtitle {
      font-size: 13px;
      color: var(--gray-500);
      font-weight: 500;
    }

    .info-box {
      background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
      border-left: 4px solid var(--info-blue);
      padding: 14px;
      border-radius: 8px;
      margin-top: 16px;
      font-size: 13px;
      line-height: 1.6;
    }

    /* ============================================
       Modern Tabs with Animations
       ============================================ */
    .tabs {
      display: flex;
      gap: 6px;
      margin-bottom: 20px;
      flex-wrap: wrap;
      position: relative;
    }

    .tab {
      padding: 14px 20px;
      border: none;
      border-radius: 12px 12px 0 0;
      font-weight: 600;
      cursor: pointer;
      font-size: 14px;
      background: rgba(255, 255, 255, 0.6);
      backdrop-filter: blur(8px);
      color: var(--gray-600);
      flex: 1;
      min-width: 90px;
      text-align: center;
      transition: all var(--transition-normal);
      border: 2px solid transparent;
      position: relative;
      overflow: hidden;
    }

    .tab::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
      transition: left var(--transition-slow);
    }

    .tab:hover::before {
      left: 100%;
    }

    .tab:hover {
      background: rgba(255, 255, 255, 0.8);
      transform: translateY(-2px);
      box-shadow: var(--shadow);
    }

    .tab.active {
      background: linear-gradient(135deg, var(--primary-red) 0%, var(--primary-red-dark) 100%);
      color: white;
      box-shadow: 0 4px 12px rgba(244, 63, 94, 0.4);
      transform: translateY(-2px) scale(1.02);
      border-color: var(--primary-red-light);
    }

    /* ============================================
       Form Inputs
       ============================================ */
    .input-group {
      display: flex;
      gap: 10px;
      margin-top: 14px;
    }

    input[type="text"] {
      flex: 1;
      padding: 14px 16px;
      border: 2px solid var(--gray-200);
      border-radius: 10px;
      font-size: 16px;
      transition: all var(--transition-fast);
      background: rgba(255, 255, 255, 0.9);
    }

    input[type="text"]:focus {
      outline: none;
      border-color: var(--info-blue);
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
      transform: translateY(-1px);
    }

    /* ç¤¾å“¡ã®è¿½åŠ ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ - ãƒ–ãƒ«ãƒ¼ */
    #employeeNumberInput:focus,
    #employeeNameInput:focus {
      outline: none;
      border-color: var(--info-blue) !important;
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.15) !important;
      transform: translateY(-1px);
    }

    /* ============================================
       Buttons with Micro-interactions
       ============================================ */
    .btn {
      padding: 14px 24px;
      border: none;
      border-radius: 10px;
      font-weight: 600;
      cursor: pointer;
      font-size: 15px;
      transition: all var(--transition-fast);
      position: relative;
      overflow: hidden;
    }

    .btn::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.3);
      transform: translate(-50%, -50%);
      transition: width var(--transition-normal), height var(--transition-normal);
    }

    .btn:active::after {
      width: 300px;
      height: 300px;
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-md);
    }

    .btn:active {
      transform: translateY(0);
    }

    /* ã‚·ãƒ£ã‚¤ãƒ³åŠ¹æœ - è¿½åŠ ãƒœã‚¿ãƒ³ï¼ˆãƒ–ãƒ«ãƒ¼ï¼‰ */
    .btn-primary {
      background: linear-gradient(135deg, var(--info-blue) 0%, var(--info-blue-light) 100%);
      color: white;
    }

    .btn-primary::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(96, 165, 250, 0.5), transparent);
      transition: left var(--transition-slow);
    }

    .btn-primary:hover::before {
      left: 100%;
    }

    .btn-primary:hover {
      box-shadow: 0 6px 16px rgba(59, 130, 246, 0.3);
    }

    /* ã‚·ãƒ£ã‚¤ãƒ³åŠ¹æœ - å†ä½¿ç”¨ãƒœã‚¿ãƒ³ï¼ˆã‚¤ã‚¨ãƒ­ãƒ¼/ã‚ªãƒ¬ãƒ³ã‚¸ï¼‰ */
    .btn-yellow {
      background: linear-gradient(135deg, var(--accent-yellow) 0%, var(--accent-orange) 100%);
      color: white;
      padding: 14px 24px;
    }

    .btn-yellow::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(252, 211, 77, 0.6), transparent);
      transition: left var(--transition-slow);
    }

    .btn-yellow:hover::before {
      left: 100%;
    }

    .btn-yellow:hover {
      box-shadow: 0 6px 16px rgba(251, 191, 36, 0.3);
    }

    .btn-success {
      background: linear-gradient(135deg, var(--success-green) 0%, var(--success-green-dark) 100%);
      color: white;
      font-size: 17px;
      padding: 18px;
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }

    .btn-success:hover {
      box-shadow: 0 8px 20px rgba(16, 185, 129, 0.3);
    }

    .reuse-group {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 14px;
    }

    .reuse-input {
      flex: 1;
      min-width: 130px;
      padding: 14px 16px;
      border: 2px solid var(--gray-200);
      border-radius: 10px;
      font-size: 16px;
      transition: all var(--transition-fast);
      background: rgba(255, 255, 255, 0.9);
    }

    .reuse-input:focus {
      outline: none;
      border-color: var(--accent-orange);
      box-shadow: 0 0 0 3px rgba(251, 146, 60, 0.1);
    }

    .reuse-number {
      width: 80px;
      padding: 14px 16px;
      border: 2px solid var(--gray-200);
      border-radius: 10px;
      font-size: 16px;
      text-align: center;
      transition: all var(--transition-fast);
      background: rgba(255, 255, 255, 0.9);
    }

    .reuse-number:focus {
      outline: none;
      border-color: var(--accent-orange);
      box-shadow: 0 0 0 3px rgba(251, 146, 60, 0.1);
    }

    /* ============================================
       Progress Bar
       ============================================ */
    .progress-container {
      width: 100%;
      height: 8px;
      background: rgba(0, 0, 0, 0.05);
      border-radius: 10px;
      overflow: hidden;
      margin: 12px 0;
      position: relative;
    }

    .progress-bar {
      height: 100%;
      background: linear-gradient(90deg, var(--success-green) 0%, var(--info-blue) 100%);
      border-radius: 10px;
      transition: width var(--transition-slow);
      position: relative;
      overflow: hidden;
    }

    .progress-bar::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      bottom: 0;
      right: 0;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
      animation: shimmer 2s infinite;
    }

    @keyframes shimmer {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }

    /* ============================================
       Statistics Section
       ============================================ */
    .stats {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 14px;
      flex-wrap: wrap;
      gap: 10px;
    }

    .stats h2 {
      font-size: 17px;
      font-weight: 700;
      color: var(--gray-900);
    }

    .stats-text {
      font-size: 14px;
      color: var(--gray-600);
      background: var(--gray-100);
      padding: 6px 12px;
      border-radius: 20px;
      font-weight: 600;
    }

    /* ============================================
       Employee List with Animations
       ============================================ */
    .employee-list {
      max-height: 450px;
      overflow-y: auto;
      padding-right: 4px;
    }

    .employee-list::-webkit-scrollbar {
      width: 8px;
    }

    .employee-list::-webkit-scrollbar-track {
      background: var(--gray-100);
      border-radius: 10px;
    }

    .employee-list::-webkit-scrollbar-thumb {
      background: var(--gray-300);
      border-radius: 10px;
    }

    .employee-list::-webkit-scrollbar-thumb:hover {
      background: var(--gray-400);
    }

    .employee-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 16px 14px;
      border: 2px solid var(--gray-200);
      border-radius: 10px;
      margin-bottom: 10px;
      background: rgba(255, 255, 255, 0.6);
      transition: all var(--transition-fast);
      animation: slideIn 0.3s ease-out;
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateX(-10px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    /* è¿½åŠ ãƒœã‚¿ãƒ³ã§ç™»éŒ²ã•ã‚ŒãŸç¤¾å“¡ - ãƒ–ãƒ«ãƒ¼èƒŒæ™¯ */
    .employee-item.type-permanent {
      background: rgba(219, 234, 254, 0.4);
      border-color: rgba(96, 165, 250, 0.3);
    }

    .employee-item.type-permanent:hover {
      background: rgba(219, 234, 254, 0.6);
      border-color: rgba(96, 165, 250, 0.5);
      transform: translateX(4px);
      box-shadow: var(--shadow);
    }

    /* å†ä½¿ç”¨ãƒœã‚¿ãƒ³ã§ç™»éŒ²ã•ã‚ŒãŸç¤¾å“¡ - ã‚¤ã‚¨ãƒ­ãƒ¼èƒŒæ™¯ */
    .employee-item.type-temporary {
      background: rgba(254, 243, 199, 0.4);
      border-color: rgba(251, 191, 36, 0.3);
    }

    .employee-item.type-temporary:hover {
      background: rgba(254, 243, 199, 0.6);
      border-color: rgba(251, 191, 36, 0.5);
      transform: translateX(4px);
      box-shadow: var(--shadow);
    }

    .employee-item:hover {
      border-color: var(--gray-300);
      background: rgba(255, 255, 255, 0.9);
      transform: translateX(4px);
      box-shadow: var(--shadow);
    }

    .employee-item.checked {
      background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
      border-color: var(--success-green);
      animation: checkPulse 0.5s ease-out;
    }

    /* ãƒã‚§ãƒƒã‚¯æ¸ˆã¿ + typeåˆ¥ã®èƒŒæ™¯è‰² */
    .employee-item.checked.type-permanent {
      background: linear-gradient(135deg, #dbeafe 0%, #dcfce7 100%);
      border-color: var(--success-green);
    }

    .employee-item.checked.type-temporary {
      background: linear-gradient(135deg, #fef3c7 0%, #dcfce7 100%);
      border-color: var(--success-green);
    }

    @keyframes checkPulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.02); }
      100% { transform: scale(1); }
    }

    /* ============================================
       Custom Checkbox with Animation
       ============================================ */
    input[type="checkbox"] {
      width: 28px;
      height: 28px;
      cursor: pointer;
      flex-shrink: 0;
      appearance: none;
      border: 2px solid var(--gray-300);
      border-radius: 6px;
      position: relative;
      transition: all var(--transition-fast);
      background: white;
    }

    input[type="checkbox"]:hover {
      border-color: var(--success-green);
      transform: scale(1.1);
    }

    input[type="checkbox"]:checked {
      background: linear-gradient(135deg, var(--success-green) 0%, var(--success-green-dark) 100%);
      border-color: var(--success-green);
    }

    input[type="checkbox"]:checked::after {
      content: 'âœ“';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: white;
      font-size: 16px;
      font-weight: bold;
      animation: checkmark 0.3s ease-out;
    }

    @keyframes checkmark {
      0% { transform: translate(-50%, -50%) scale(0) rotate(-45deg); }
      50% { transform: translate(-50%, -50%) scale(1.2) rotate(0deg); }
      100% { transform: translate(-50%, -50%) scale(1) rotate(0deg); }
    }

    .employee-name {
      flex: 1;
      font-size: 16px;
      color: var(--gray-900);
      font-weight: 500;
      word-break: break-word;
      transition: all var(--transition-fast);
    }

    .employee-name.checked {
      color: var(--gray-400);
      text-decoration: line-through;
    }

    .btn-delete {
      padding: 10px 18px;
      background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
      border: 2px solid transparent;
      color: var(--primary-red);
      cursor: pointer;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      flex-shrink: 0;
      transition: all var(--transition-fast);
    }

    .btn-delete:hover {
      background: var(--primary-red);
      color: white;
      border-color: var(--primary-red-dark);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(244, 63, 94, 0.3);
    }

    /* ============================================
       Modal with Fade Animation
       ============================================ */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(4px);
      align-items: center;
      justify-content: center;
      padding: 20px;
      z-index: 1000;
      animation: fadeIn 0.3s ease-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    .modal.show {
      display: flex;
    }

    .modal-content {
      background: white;
      border-radius: 20px;
      padding: 28px;
      max-width: 520px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: var(--shadow-xl);
      animation: modalSlideIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }

    @keyframes modalSlideIn {
      from {
        opacity: 0;
        transform: translateY(-50px) scale(0.9);
      }
      to {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }

    .modal-header {
      display: flex;
      align-items: center;
      gap: 14px;
      margin-bottom: 18px;
    }

    .modal-icon {
      padding: 14px;
      border-radius: 50%;
      flex-shrink: 0;
      font-size: 24px;
    }

    .modal-icon.warning {
      background: linear-gradient(135deg, var(--primary-red) 0%, var(--primary-red-dark) 100%);
      box-shadow: 0 4px 12px rgba(244, 63, 94, 0.3);
    }

    .modal-icon.success {
      background: linear-gradient(135deg, var(--success-green) 0%, var(--success-green-dark) 100%);
      box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
    }

    .modal-title {
      font-size: 20px;
      font-weight: 700;
    }

    .modal-title.warning {
      color: var(--primary-red-dark);
    }

    .modal-title.success {
      color: var(--success-green-dark);
    }

    .unchecked-list {
      background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
      border: 2px solid var(--primary-red-light);
      border-radius: 10px;
      padding: 18px;
      margin: 18px 0;
      max-height: 220px;
      overflow-y: auto;
    }

    .unchecked-item {
      display: flex;
      align-items: center;
      gap: 10px;
      color: #991b1b;
      font-weight: 500;
      margin-bottom: 10px;
      font-size: 15px;
      animation: slideIn 0.3s ease-out;
    }

    .dot {
      width: 8px;
      height: 8px;
      background: var(--primary-red);
      border-radius: 50%;
      flex-shrink: 0;
      animation: pulse 2s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.2); opacity: 0.8; }
    }

    .success-box {
      background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
      border: 2px solid var(--success-green);
      border-radius: 12px;
      padding: 28px;
      text-align: center;
      margin: 18px 0;
    }

    .success-emoji {
      font-size: 56px;
      margin-bottom: 12px;
      animation: bounce 0.6s ease-out;
    }

    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      25% { transform: translateY(-10px); }
      50% { transform: translateY(0); }
      75% { transform: translateY(-5px); }
    }

    .btn-modal {
      width: 100%;
      padding: 16px;
      border: none;
      border-radius: 10px;
      font-weight: 600;
      cursor: pointer;
      font-size: 16px;
      transition: all var(--transition-fast);
    }

    .btn-modal:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-md);
    }

    .btn-modal.dark {
      background: linear-gradient(135deg, var(--gray-800) 0%, var(--gray-900) 100%);
      color: white;
    }

    .btn-modal.success {
      background: linear-gradient(135deg, var(--success-green) 0%, var(--success-green-dark) 100%);
      color: white;
    }

    .section-title {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 17px;
      font-weight: 700;
      margin-bottom: 14px;
      color: var(--gray-900);
    }

    /* ============================================
       Responsive Design
       ============================================ */
    @media (max-width: 480px) {
      body {
        padding: 12px;
      }

      .card {
        padding: 16px;
      }

      .reuse-group {
        flex-direction: column;
      }

      .reuse-number {
        width: 100%;
      }

      .reuse-input {
        width: 100%;
      }

      .btn-yellow {
        width: 100%;
        text-align: center;
      }

      .tab {
        padding: 12px 10px;
        font-size: 13px;
      }

      h1 {
        font-size: 19px;
      }

      .icon-box {
        font-size: 20px;
        padding: 12px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="card">
      <div class="header">
        <div class="icon-box">ğŸ”¥</div>
        <div style="flex: 1;"><h1>ç¯æ²¹ã‚¹ãƒˆãƒ¼ãƒ–æ¶ˆç«ç¢ºèª</h1><p class="subtitle">ç«å™¨å®‰å…¨ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </p></div>
      </div>
      <div class="info-box">
        <p style="color: #1e40af;"><strong>æ¯æ—¥AM3æ™‚ã«è‡ªå‹•ãƒªã‚»ãƒƒãƒˆ</strong> ã•ã‚Œã¾ã™ã€‚é€€ç¤¾æ™‚ã«å¿…ãšãƒã‚§ãƒƒã‚¯ã—ã¦ãã ã•ã„ã€‚</p>
        <p style="color: #6b7280; font-size: 12px; margin-top: 8px;" id="resetInfo">æœ€çµ‚ãƒªã‚»ãƒƒãƒˆ: æœªå®Ÿè¡Œ</p>
        <p style="font-size: 11px; margin-top: 8px;" id="firebaseStatus">
          <span style="color: #f59e0b;">ğŸ”„ æ¥ç¶šç¢ºèªä¸­...</span>
        </p>
      </div>
    </div>
    
    <div class="tabs">
      <button class="tab active" onclick="switchTab(0)">ç¬¬ä¸€å·¥å ´</button>
      <button class="tab" onclick="switchTab(1)">ç¬¬äºŒå·¥å ´</button>
      <button class="tab" onclick="switchTab(2)">ç¬¬ä¸‰å·¥å ´</button>
      <button class="tab" onclick="switchTab(3)">ç¬¬å››å·¥å ´</button>
    </div>
    
    <div class="card">
      <div class="section-title">ç¤¾å“¡ã®è¿½åŠ </div>
      <div class="reuse-group">
        <input type="text" id="employeeNumberInput" class="reuse-number" placeholder="ç•ªå·">
        <input type="text" id="employeeNameInput" class="reuse-input" placeholder="è‡ªåˆ†ã®åå‰ã‚’å…¥åŠ›">
        <button class="btn btn-primary" onclick="addEmployee()">è¿½åŠ </button>
      </div>
    </div>
    <div class="card">
      <div class="section-title">å†ä½¿ç”¨</div>
      <div class="reuse-group">
        <input type="text" id="reuseNumberInput" class="reuse-number" placeholder="ç•ªå·">
        <input type="text" id="reuseNameInput" class="reuse-input" placeholder="è‡ªåˆ†ã®åå‰ã‚’å…¥åŠ›">
        <button class="btn btn-yellow" onclick="reuseEmployee()">å†ä½¿ç”¨</button>
      </div>
    </div>
    <div class="card">
      <div class="stats"><h2 id="listTitle">æ¶ˆç«ç¢ºèªãƒªã‚¹ãƒˆ (0/0)</h2><span class="stats-text" id="uncheckedCount">æœªç¢ºèª: 0å</span></div>
      <div class="progress-container">
        <div class="progress-bar" id="progressBar" style="width: 0%"></div>
      </div>
      <div class="employee-list" id="employeeList"></div>
    </div>
    <div class="card">
      <button class="btn btn-success" onclick="handleFinalCheck()">âœ“ æœ€çµ‚ç¢ºèªãƒ»å®Œäº†</button>
    </div>
    <div class="card" style="background: #f3f4f6;">
      <div class="section-title" style="font-size: 14px; color: #6b7280;">ğŸ”§ ãƒ‡ãƒãƒƒã‚°ãƒ»ãƒ†ã‚¹ãƒˆæ©Ÿèƒ½</div>
      <div style="display: flex; gap: 8px; flex-wrap: wrap; margin-top: 12px;">
        <button class="btn btn-primary" style="flex: 1; min-width: 140px; font-size: 13px;" onclick="testFirebaseSync()">ğŸ”„ åŒæœŸãƒ†ã‚¹ãƒˆ</button>
        <button class="btn" style="flex: 1; min-width: 140px; background: #6b7280; color: white; font-size: 13px;" onclick="showDebugInfo()">ğŸ› æ¥ç¶šæƒ…å ±</button>
        <button class="btn" style="flex: 1; min-width: 140px; background: #f59e0b; color: white; font-size: 13px;" onclick="debugEmployeeTypes()">ğŸ” ç¤¾å“¡TYPEç¢ºèª</button>
        <button class="btn" style="flex: 1; min-width: 140px; background: #ef4444; color: white; font-size: 13px;" onclick="testResetFunction()">ğŸ§ª ãƒªã‚»ãƒƒãƒˆãƒ†ã‚¹ãƒˆ</button>
      </div>
    </div>
  </div>
  <div class="modal" id="warningModal"><div class="modal-content" id="modalContent"></div></div>

<script>
var factoryNames = ['ç¬¬ä¸€å·¥å ´', 'ç¬¬äºŒå·¥å ´', 'ç¬¬ä¸‰å·¥å ´', 'ç¬¬å››å·¥å ´'];
var allEmployees = {};
var currentTab = 0;

function init() {
  // Firebaseã‚’åˆæœŸåŒ–ï¼ˆå­˜åœ¨ã™ã‚‹å ´åˆã®ã¿ï¼‰
  var firebaseInitialized = false;
  if (typeof initFirebase === 'function') {
    try {
      firebaseInitialized = initFirebase();
      updateFirebaseStatus(firebaseInitialized);
    } catch (e) {
      console.warn('FirebaseåˆæœŸåŒ–ã‚’ã‚¹ã‚­ãƒƒãƒ—:', e);
      updateFirebaseStatus(false);
    }
  } else {
    updateFirebaseStatus(false);
  }

  loadData();
  checkAndResetDaily();
  renderEmployeeList();
  updateResetInfo();

  // FirebaseåŒæœŸãƒªã‚¹ãƒŠãƒ¼ã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
  if (typeof isFirebaseConnected === 'function' && isFirebaseConnected()) {
    setupFirebaseListeners();
  }
}

function updateFirebaseStatus(isConnected) {
  var statusElement = document.getElementById('firebaseStatus');
  if (!statusElement) return;

  if (isConnected) {
    statusElement.innerHTML = '<span style="color: #10b981;">âœ… ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åŒæœŸ: æœ‰åŠ¹ï¼ˆå…¨ãƒ‡ãƒã‚¤ã‚¹é€£å‹•ï¼‰</span>';
  } else {
    statusElement.innerHTML = '<span style="color: #6b7280;">ğŸ“± ãƒ­ãƒ¼ã‚«ãƒ«ãƒ¢ãƒ¼ãƒ‰: ã“ã®ãƒ‡ãƒã‚¤ã‚¹ã®ã¿</span>';
  }
}

function updateResetInfo() {
  var lastReset = localStorage.getItem('heater-last-reset');
  var infoElement = document.getElementById('resetInfo');
  if (infoElement) {
    if (lastReset) {
      var resetDate = new Date(lastReset);
      infoElement.textContent = 'æœ€çµ‚ãƒªã‚»ãƒƒãƒˆ: ' + resetDate.toLocaleString('ja-JP');
    } else {
      infoElement.textContent = 'æœ€çµ‚ãƒªã‚»ãƒƒãƒˆ: æœªå®Ÿè¡Œ';
    }
  }
}

function loadData() {
  if (typeof isFirebaseConnected === 'function' && isFirebaseConnected()) {
    // Firebaseã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿
    try {
      var db = getDatabase();
      for (var i = 0; i < factoryNames.length; i++) {
        (function(factoryIndex) {
          db.ref('factories/' + factoryIndex + '/employees').once('value').then(function(snapshot) {
            var data = snapshot.val();
            if (data) {
              allEmployees[factoryIndex] = data;
            } else {
              allEmployees[factoryIndex] = [];
            }
            if (factoryIndex === currentTab) {
              renderEmployeeList();
            }
          }).catch(function(error) {
            console.warn('Firebaseèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
            loadFromLocalStorage(factoryIndex);
          });
        })(i);
      }
    } catch (e) {
      console.warn('Firebaseä½¿ç”¨ä¸å¯ã€localStorageã‹ã‚‰èª­ã¿è¾¼ã¿');
      loadFromLocalStorage();
    }
  } else {
    // localStorageã‹ã‚‰èª­ã¿è¾¼ã¿ï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼‰
    loadFromLocalStorage();
  }
}

function loadFromLocalStorage(factoryIndex) {
  if (factoryIndex !== undefined) {
    var key = 'heater-employees-' + factoryIndex;
    var saved = localStorage.getItem(key);
    if (saved) {
      allEmployees[factoryIndex] = JSON.parse(saved);
      // ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³: typeãŒãªã„ç¤¾å“¡ã«permanentã‚’è¨­å®š
      migrateEmployeeTypes(factoryIndex);
    } else {
      allEmployees[factoryIndex] = [];
    }
    if (factoryIndex === currentTab) {
      renderEmployeeList();
    }
  } else {
    for (var i = 0; i < factoryNames.length; i++) {
      var key = 'heater-employees-' + i;
      var saved = localStorage.getItem(key);
      if (saved) {
        allEmployees[i] = JSON.parse(saved);
        // ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³: typeãŒãªã„ç¤¾å“¡ã«permanentã‚’è¨­å®š
        migrateEmployeeTypes(i);
      } else {
        allEmployees[i] = [];
      }
    }
  }
}

// ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³: typeãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒãªã„æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã«permanentã‚’è¨­å®š
function migrateEmployeeTypes(factoryIndex) {
  var employees = allEmployees[factoryIndex];
  var needsSave = false;

  for (var i = 0; i < employees.length; i++) {
    if (!employees[i].type) {
      console.log('ğŸ”„ ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³: ' + employees[i].name + ' ã« type=permanent ã‚’è¨­å®š');
      employees[i].type = 'permanent';
      needsSave = true;
    }
  }

  // ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã—ãŸå ´åˆã¯ä¿å­˜
  if (needsSave) {
    var key = 'heater-employees-' + factoryIndex;
    localStorage.setItem(key, JSON.stringify(employees));
    console.log('ğŸ’¾ å·¥å ´' + (factoryIndex + 1) + 'ã®ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä¿å­˜ã—ã¾ã—ãŸ');
  }
}

function saveData() {
  // localStorageã«ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ä¿å­˜ï¼ˆã‚ªãƒ•ãƒ©ã‚¤ãƒ³æ™‚ç”¨ï¼‰
  var key = 'heater-employees-' + currentTab;
  localStorage.setItem(key, JSON.stringify(allEmployees[currentTab]));

  // Firebaseã«ä¿å­˜ï¼ˆå…¨ãƒ‡ãƒã‚¤ã‚¹åŒæœŸï¼‰
  if (typeof isFirebaseConnected === 'function' && isFirebaseConnected()) {
    try {
      var db = getDatabase();
      db.ref('factories/' + currentTab + '/employees').set(allEmployees[currentTab])
        .then(function() {
          console.log('âœ… ãƒ‡ãƒ¼ã‚¿åŒæœŸæˆåŠŸ - å·¥å ´' + (currentTab + 1));
        })
        .catch(function(error) {
          console.error('âŒ ãƒ‡ãƒ¼ã‚¿åŒæœŸã‚¨ãƒ©ãƒ¼:', error);
        });
    } catch (e) {
      console.warn('Firebaseä¿å­˜ã‚¹ã‚­ãƒƒãƒ—:', e);
    }
  }

  // ãƒ‡ãƒ¼ã‚¿å¤‰æ›´ã‚¤ãƒ™ãƒ³ãƒˆã‚’ç™ºç«ï¼ˆç®¡ç†ç”»é¢ã¸ã®é€šçŸ¥ï¼‰
  window.dispatchEvent(new Event('dataUpdated'));
}

function checkAndResetDaily() {
  var lastReset = localStorage.getItem('heater-last-reset');
  var now = new Date();
  var today = now.toDateString();
  var currentHour = now.getHours();

  console.log('â° ãƒªã‚»ãƒƒãƒˆãƒã‚§ãƒƒã‚¯ - ç¾åœ¨æ™‚åˆ»:', currentHour + 'æ™‚', 'æœ€çµ‚ãƒªã‚»ãƒƒãƒˆ:', lastReset, 'ä»Šæ—¥:', today);

  // AM3æ™‚ä»¥é™ã§ã€ã‹ã¤å‰å›ã®ãƒªã‚»ãƒƒãƒˆãŒä»Šæ—¥ã§ãªã„å ´åˆã«ãƒªã‚»ãƒƒãƒˆ
  if (currentHour >= 3 && lastReset !== today) {
    console.log('ğŸ”„ AM3æ™‚ãƒªã‚»ãƒƒãƒˆå®Ÿè¡Œä¸­...');
    console.log('ğŸ“ ãƒã‚§ãƒƒã‚¯çŠ¶æ…‹ã¨ã€Œå†ä½¿ç”¨ã€ã§è¿½åŠ ã•ã‚ŒãŸç¤¾å“¡ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã™');

    // å…¨å·¥å ´ã‚’ãƒªã‚»ãƒƒãƒˆ
    for (var f = 0; f < factoryNames.length; f++) {
      var employees = allEmployees[f] || [];
      var resetEmployees = [];

      // ãƒªã‚»ãƒƒãƒˆãƒ­ã‚¸ãƒƒã‚¯:
      // - type ãŒ 'temporary' (å†ä½¿ç”¨ãƒœã‚¿ãƒ³) â†’ å‰Šé™¤
      // - type ãŒ 'permanent' (è¿½åŠ ãƒœã‚¿ãƒ³) â†’ æ®‹ã™ï¼ˆãƒã‚§ãƒƒã‚¯ã®ã¿ãƒªã‚»ãƒƒãƒˆï¼‰
      // - type ãŒæœªè¨­å®š/null/undefined â†’ æ®‹ã™ï¼ˆãƒã‚§ãƒƒã‚¯ã®ã¿ãƒªã‚»ãƒƒãƒˆï¼‰â€»æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ä¿è­·
      for (var i = 0; i < employees.length; i++) {
        var emp = employees[i];

        // æ˜ç¤ºçš„ã«temporaryã®å ´åˆã®ã¿å‰Šé™¤
        if (emp.type === 'temporary') {
          console.log('ğŸ—‘ï¸ å‰Šé™¤: ' + emp.name + ' [type=' + emp.type + '] (å†ä½¿ç”¨ãƒœã‚¿ãƒ³ã§ç™»éŒ²)');
        } else {
          // permanent ã¾ãŸã¯ typeæœªè¨­å®šã®å ´åˆã¯æ®‹ã™
          emp.checked = false;
          resetEmployees.push(emp);
          var typeLabel = emp.type || 'æœªè¨­å®š';
          console.log('âœ… æ®‹ã™: ' + emp.name + ' [type=' + typeLabel + '] (è¿½åŠ ãƒœã‚¿ãƒ³ or æ—¢å­˜ãƒ‡ãƒ¼ã‚¿)');
        }
      }

      allEmployees[f] = resetEmployees;

      // localStorageã«ä¿å­˜
      var key = 'heater-employees-' + f;
      localStorage.setItem(key, JSON.stringify(allEmployees[f]));

      // Firebaseã«ã‚‚ãƒªã‚»ãƒƒãƒˆã‚’ä¿å­˜
      if (typeof isFirebaseConnected === 'function' && isFirebaseConnected()) {
        try {
          var db = getDatabase();
          db.ref('factories/' + f + '/employees').set(allEmployees[f]);
          console.log('ğŸ”¥ Firebaseå·¥å ´' + (f + 1) + 'ã‚’ãƒªã‚»ãƒƒãƒˆ');
        } catch (e) {
          console.warn('Firebaseãƒªã‚»ãƒƒãƒˆä¿å­˜ã‚¹ã‚­ãƒƒãƒ—:', e);
        }
      }
    }

    // ãƒªã‚»ãƒƒãƒˆæ—¥æ™‚ã‚’è¨˜éŒ²
    localStorage.setItem('heater-last-reset', today);

    // Firebaseã«ãƒªã‚»ãƒƒãƒˆæ™‚åˆ»ã‚’ä¿å­˜
    if (typeof syncResetToFirebase === 'function') {
      syncResetToFirebase();
    }

    // å±¥æ­´è¨˜éŒ²ï¼ˆå„å·¥å ´ï¼‰
    for (var f = 0; f < factoryNames.length; f++) {
      var resetEmployees = allEmployees[f] || [];
      saveActivityLog('reset', '', '', {
        factory: f,
        factoryName: factoryNames[f],
        totalEmployees: resetEmployees.length,
        autoReset: true
      });
    }

    // UIã‚’æ›´æ–°
    renderEmployeeList();

    console.log('âœ… ãƒªã‚»ãƒƒãƒˆå®Œäº† - å†ä½¿ç”¨ã®ç¤¾å“¡ã‚’å‰Šé™¤ã€è¿½åŠ ã®ç¤¾å“¡ã¯ç¶­æŒã—ã¾ã—ãŸ');
  } else {
    console.log('â„¹ï¸ ãƒªã‚»ãƒƒãƒˆä¸è¦ï¼ˆæ¡ä»¶: AM3æ™‚ä»¥é™ ã‹ã¤ ä»Šæ—¥æœªå®Ÿè¡Œï¼‰');
  }

  setTimeout(checkAndResetDaily, 60000);
}

function switchTab(index) {
  currentTab = index;
  var tabs = document.getElementsByClassName('tab');
  for (var i = 0; i < tabs.length; i++) {
    tabs[i].className = 'tab';
  }
  tabs[index].className = 'tab active';
  renderEmployeeList();
}

function getEmployees() {
  if (!allEmployees[currentTab]) {
    allEmployees[currentTab] = [];
  }
  return allEmployees[currentTab];
}

function renderEmployeeList() {
  var employees = getEmployees();
  var list = document.getElementById('employeeList');
  var checkedCount = 0;
  for (var i = 0; i < employees.length; i++) {
    if (employees[i].checked) {
      checkedCount = checkedCount + 1;
    }
  }
  var uncheckedCount = employees.length - checkedCount;

  // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã®æ›´æ–°
  var progressPercentage = employees.length > 0 ? (checkedCount / employees.length) * 100 : 0;
  var progressBar = document.getElementById('progressBar');
  if (progressBar) {
    progressBar.style.width = progressPercentage + '%';
  }

  document.getElementById('listTitle').textContent = factoryNames[currentTab] + ' æ¶ˆç«ç¢ºèªãƒªã‚¹ãƒˆ (' + checkedCount + '/' + employees.length + ')';
  document.getElementById('uncheckedCount').textContent = 'æœªç¢ºèª: ' + uncheckedCount + 'å';
  var html = '';
  for (var i = 0; i < employees.length; i++) {
    var emp = employees[i];
    var checkedClass = emp.checked ? 'checked' : '';
    var checkedAttr = emp.checked ? 'checked' : '';

    // typeã«å¿œã˜ã¦ã‚¯ãƒ©ã‚¹ã‚’è¿½åŠ 
    var typeClass = '';
    if (emp.type === 'permanent') {
      typeClass = 'type-permanent';
    } else if (emp.type === 'temporary') {
      typeClass = 'type-temporary';
    }

    html = html + '<div class="employee-item ' + checkedClass + ' ' + typeClass + '">';
    html = html + '<input type="checkbox" ' + checkedAttr + ' onchange="toggleCheck(' + emp.id + ')">';
    html = html + '<span class="employee-name ' + checkedClass + '">' + emp.name + '</span>';
    html = html + '<button class="btn-delete" onclick="deleteEmployee(' + emp.id + ')">å‰Šé™¤</button></div>';
  }
  list.innerHTML = html;
}

function toggleCheck(id) {
  var employees = getEmployees();
  for (var i = 0; i < employees.length; i++) {
    if (employees[i].id === id) {
      var wasChecked = employees[i].checked;
      employees[i].checked = !employees[i].checked;

      // å±¥æ­´è¨˜éŒ²
      saveActivityLog(
        employees[i].checked ? 'check' : 'uncheck',
        employees[i].name,
        employees[i].type
      );

      break;
    }
  }
  saveData();
  renderEmployeeList();
}

function addEmployee() {
  var numberInput = document.getElementById('employeeNumberInput');
  var nameInput = document.getElementById('employeeNameInput');
  var number = numberInput.value.trim();
  var name = nameInput.value.trim();

  if (number && name) {
    var employees = getEmployees();
    var newEmp = new Object();
    newEmp.id = Date.now();
    newEmp.name = number + ' ' + name;
    newEmp.checked = false;
    newEmp.type = 'permanent'; // ã€Œè¿½åŠ ã€ãƒœã‚¿ãƒ³ã¯æ°¸ç¶šçš„ï¼ˆå‰Šé™¤ã—ãªã„ï¼‰
    employees.push(newEmp);

    // å±¥æ­´è¨˜éŒ²
    saveActivityLog('add', newEmp.name, newEmp.type);

    saveData();
    renderEmployeeList();
    numberInput.value = '';
    nameInput.value = '';
  }
}

function deleteEmployee(id) {
  var employees = getEmployees();
  var newEmployees = [];
  var deletedEmployee = null;

  for (var i = 0; i < employees.length; i++) {
    if (employees[i].id !== id) {
      newEmployees.push(employees[i]);
    } else {
      deletedEmployee = employees[i];
    }
  }

  // å±¥æ­´è¨˜éŒ²
  if (deletedEmployee) {
    saveActivityLog('delete', deletedEmployee.name, deletedEmployee.type);
  }

  allEmployees[currentTab] = newEmployees;
  saveData();
  renderEmployeeList();
}

function reuseEmployee() {
  var numberInput = document.getElementById('reuseNumberInput');
  var nameInput = document.getElementById('reuseNameInput');
  var number = numberInput.value.trim();
  var name = nameInput.value.trim();

  if (number && name) {
    var employees = getEmployees();
    var newEmp = new Object();
    newEmp.id = Date.now();
    newEmp.name = number + ' ' + name;
    newEmp.checked = false;
    newEmp.type = 'temporary'; // ã€Œå†ä½¿ç”¨ã€ãƒœã‚¿ãƒ³ã¯ä¸€æ™‚çš„ï¼ˆAM3æ™‚ã«å‰Šé™¤ï¼‰
    employees.push(newEmp);

    // å±¥æ­´è¨˜éŒ²
    saveActivityLog('reuse', newEmp.name, newEmp.type);

    saveData();
    renderEmployeeList();
    numberInput.value = '';
    nameInput.value = '';
  }
}

function handleFinalCheck() {
  var employees = getEmployees();
  var unchecked = [];
  for (var i = 0; i < employees.length; i++) {
    if (!employees[i].checked) {
      unchecked.push(employees[i]);
    }
  }

  // å±¥æ­´è¨˜éŒ²ï¼šæœ€çµ‚ç¢ºèªã®å®Ÿè¡Œ
  var additionalInfo = {
    totalCount: employees.length,
    checkedCount: employees.length - unchecked.length,
    uncheckedCount: unchecked.length,
    success: unchecked.length === 0,
    uncheckedNames: unchecked.map(function(e) { return e.name; })
  };
  saveActivityLog('final-check', '', '', additionalInfo);

  var modal = document.getElementById('warningModal');
  var content = document.getElementById('modalContent');
  var html = '';
  if (unchecked.length > 0) {
    html = html + '<div class="modal-header"><div class="modal-icon warning">âš ï¸</div>';
    html = html + '<h3 class="modal-title warning">è­¦å‘Š</h3></div>';
    html = html + '<p style="color: #374151; font-weight: 600; margin-bottom: 16px;">';
    html = html + 'ã€' + factoryNames[currentTab] + 'ã€‘<br>ä»¥ä¸‹ã®' + unchecked.length + 'åã®æ¶ˆç«ç¢ºèªãŒå®Œäº†ã—ã¦ã„ã¾ã›ã‚“ï¼š</p>';
    html = html + '<div class="unchecked-list">';
    for (var i = 0; i < unchecked.length; i++) {
      html = html + '<div class="unchecked-item"><span class="dot"></span>' + unchecked[i].name + '</div>';
    }
    html = html + '</div><button class="btn-modal dark" onclick="closeModal()">ç¢ºèªã—ã¾ã—ãŸ</button>';
  } else {
    html = html + '<div class="modal-header"><div class="modal-icon success">âœ“</div>';
    html = html + '<h3 class="modal-title success">ç¢ºèªå®Œäº†</h3></div>';
    html = html + '<p style="color: #374151; font-weight: 600; text-align: center; margin-bottom: 16px;">';
    html = html + 'ã€' + factoryNames[currentTab] + 'ã€‘<br>å…¨å“¡ã®æ¶ˆç«ç¢ºèªãŒå®Œäº†ã—ã¾ã—ãŸï¼</p>';
    html = html + '<div class="success-box"><div class="success-emoji">ğŸ‰</div>';
    html = html + '<p style="color: #166534; font-weight: 500;">' + employees.length + 'åå…¨å“¡ã®å®‰å…¨ç¢ºèªæ¸ˆã¿</p>';
    html = html + '<p style="color: #6b7280; font-size: 14px; margin-top: 8px;">ãŠç–²ã‚Œæ§˜ã§ã—ãŸ</p></div>';
    html = html + '<button class="btn-modal success" onclick="closeModal()">é–‰ã˜ã‚‹</button>';
  }
  content.innerHTML = html;
  modal.classList.add('show');
}

function closeModal() {
  document.getElementById('warningModal').classList.remove('show');
}

function setupEvents() {
  var numberInput = document.getElementById('employeeNumberInput');
  var nameInput = document.getElementById('employeeNameInput');

  numberInput.onkeypress = function(e) {
    if (e.key === 'Enter') {
      addEmployee();
    }
  };

  nameInput.onkeypress = function(e) {
    if (e.key === 'Enter') {
      addEmployee();
    }
  };

  init();
}

// ãƒ‡ãƒãƒƒã‚°ãƒ»ãƒ†ã‚¹ãƒˆæ©Ÿèƒ½
function testFirebaseSync() {
  console.log('ğŸ”„ FirebaseåŒæœŸãƒ†ã‚¹ãƒˆé–‹å§‹...');

  var isConnected = typeof isFirebaseConnected === 'function' && isFirebaseConnected();

  if (!isConnected) {
    alert('âŒ Firebaseæœªæ¥ç¶š\n\nFirebaseåŒæœŸãŒç„¡åŠ¹ã§ã™ã€‚\nãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãƒ¢ãƒ¼ãƒ‰ã§å‹•ä½œã—ã¦ã„ã¾ã™ã€‚\n\nè©³ç´°ã¯ãƒ–ãƒ©ã‚¦ã‚¶ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚');
    console.error('Firebaseæ¥ç¶šå¤±æ•—');
    return;
  }

  try {
    var db = getDatabase();
    var testData = {
      name: 'ãƒ†ã‚¹ãƒˆåŒæœŸ_' + new Date().toLocaleTimeString('ja-JP'),
      checked: false,
      type: 'temporary',
      timestamp: new Date().toISOString()
    };

    console.log('ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’æ›¸ãè¾¼ã¿ä¸­...', testData);

    db.ref('test/syncTest').set(testData)
      .then(function() {
        console.log('âœ… æ›¸ãè¾¼ã¿æˆåŠŸ');

        return db.ref('test/syncTest').once('value');
      })
      .then(function(snapshot) {
        var readData = snapshot.val();
        console.log('âœ… èª­ã¿è¾¼ã¿æˆåŠŸ', readData);

        alert('âœ… åŒæœŸãƒ†ã‚¹ãƒˆæˆåŠŸï¼\n\nFirebaseã¨ã®é€šä¿¡ãŒæ­£å¸¸ã«å‹•ä½œã—ã¦ã„ã¾ã™ã€‚\n\næ›¸ãè¾¼ã‚“ã ãƒ‡ãƒ¼ã‚¿:\n' + JSON.stringify(readData, null, 2));
      })
      .catch(function(error) {
        console.error('âŒ åŒæœŸã‚¨ãƒ©ãƒ¼:', error);
        alert('âŒ åŒæœŸã‚¨ãƒ©ãƒ¼\n\n' + error.message);
      });

  } catch (e) {
    console.error('âŒ ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã‚¨ãƒ©ãƒ¼:', e);
    alert('âŒ ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã‚¨ãƒ©ãƒ¼\n\n' + e.message);
  }
}

function showDebugInfo() {
  var info = 'ğŸ”§ Firebaseæ¥ç¶šæƒ…å ±\n\n';

  var isConnected = typeof isFirebaseConnected === 'function' && isFirebaseConnected();

  info += 'æ¥ç¶šçŠ¶æ…‹: ' + (isConnected ? 'âœ… æ¥ç¶šä¸­' : 'âŒ æœªæ¥ç¶š') + '\n';
  info += 'Firebase SDK: ' + (typeof firebase !== 'undefined' ? 'âœ… èª­ã¿è¾¼ã¿æ¸ˆã¿' : 'âŒ æœªèª­ã¿è¾¼ã¿') + '\n';
  info += 'ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹: ' + (typeof getDatabase === 'function' && getDatabase() !== null ? 'âœ… åˆæœŸåŒ–æ¸ˆã¿' : 'âŒ æœªåˆæœŸåŒ–') + '\n\n';

  info += '--- ãƒ­ãƒ¼ã‚«ãƒ«ãƒ‡ãƒ¼ã‚¿ ---\n';
  info += 'å·¥å ´: ' + factoryNames[currentTab] + '\n';
  var employees = getEmployees();
  info += 'ç¤¾å“¡æ•°: ' + employees.length + 'å\n\n';

  for (var i = 0; i < Math.min(employees.length, 5); i++) {
    var emp = employees[i];
    info += (i + 1) + '. ' + emp.name + '\n';
    info += '   type: ' + (emp.type || 'ãªã—') + '\n';
    info += '   checked: ' + (emp.checked ? 'ON' : 'OFF') + '\n';
  }

  if (employees.length > 5) {
    info += '... ä»–' + (employees.length - 5) + 'å\n';
  }

  info += '\n--- è¨­å®š ---\n';
  info += 'ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ: heater-checker\n';
  info += 'ãƒªãƒ¼ã‚¸ãƒ§ãƒ³: asia-southeast1\n';

  console.log(info);
  alert(info);
}

if (window.addEventListener) {
  window.addEventListener('load', setupEvents, false);
} else if (window.attachEvent) {
  window.attachEvent('onload', setupEvents);
} else {
  window.onload = setupEvents;
}

// Service Worker Registration
if ('serviceWorker' in navigator) {
  window.addEventListener('load', function() {
    navigator.serviceWorker.register('./sw.js')
      .then(function(registration) {
        console.log('Service Worker registered successfully:', registration.scope);
      })
      .catch(function(error) {
        console.log('Service Worker registration failed:', error);
      });
  });
}

// Firebaseãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åŒæœŸãƒªã‚¹ãƒŠãƒ¼
function setupFirebaseListeners() {
  if (typeof isFirebaseConnected !== 'function' || !isFirebaseConnected()) return;

  try {
    var db = getDatabase();
    console.log('ğŸ”„ ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åŒæœŸã‚’é–‹å§‹...');

    // å„å·¥å ´ã®ãƒ‡ãƒ¼ã‚¿å¤‰æ›´ã‚’ãƒªã‚¹ãƒ‹ãƒ³ã‚°
    for (var i = 0; i < factoryNames.length; i++) {
      (function(factoryIndex) {
        db.ref('factories/' + factoryIndex + '/employees').on('value', function(snapshot) {
          var data = snapshot.val();

          // ãƒ‡ãƒ¼ã‚¿ãŒå­˜åœ¨ã™ã‚‹å ´åˆã‚‚ã€nullã‚„ç©ºé…åˆ—ã®å ´åˆã‚‚å‡¦ç†
          if (data === null || data === undefined) {
            // Firebaseã§ãƒ‡ãƒ¼ã‚¿ãŒå‰Šé™¤ã•ã‚ŒãŸï¼ˆãƒªã‚»ãƒƒãƒˆã•ã‚ŒãŸï¼‰å ´åˆ
            allEmployees[factoryIndex] = [];
            console.log('ğŸ”„ ' + factoryNames[factoryIndex] + 'ãŒãƒªã‚»ãƒƒãƒˆã•ã‚Œã¾ã—ãŸï¼ˆFirebaseåŒæœŸï¼‰');
          } else {
            allEmployees[factoryIndex] = data;
            console.log('ğŸ”„ ' + factoryNames[factoryIndex] + 'ã®ãƒ‡ãƒ¼ã‚¿ã‚’åŒæœŸã—ã¾ã—ãŸ');
          }

          // ç¾åœ¨è¡¨ç¤ºä¸­ã®å·¥å ´ã®å ´åˆã¯UIã‚’æ›´æ–°
          if (factoryIndex === currentTab) {
            renderEmployeeList();
          }

          // localStorageã«ã‚‚ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
          var key = 'heater-employees-' + factoryIndex;
          localStorage.setItem(key, JSON.stringify(allEmployees[factoryIndex]));
        });
      })(i);
    }

    // ãƒªã‚»ãƒƒãƒˆæ™‚åˆ»ã®åŒæœŸ
    db.ref('settings/lastReset').on('value', function(snapshot) {
      var lastReset = snapshot.val();
      if (lastReset) {
        var currentLocalReset = localStorage.getItem('heater-last-reset');
        if (currentLocalReset !== lastReset) {
          localStorage.setItem('heater-last-reset', lastReset);
          console.log('ğŸ”„ ãƒªã‚»ãƒƒãƒˆæ™‚åˆ»ã‚’åŒæœŸ:', lastReset);
        }
      }
    });

    console.log('âœ… å…¨ãƒ‡ãƒã‚¤ã‚¹åŒæœŸãŒæœ‰åŠ¹ã«ãªã‚Šã¾ã—ãŸï¼');
    console.log('ğŸ’¡ ä»–ã®ãƒ‡ãƒã‚¤ã‚¹ã§ã®å¤‰æ›´ãŒè‡ªå‹•çš„ã«åæ˜ ã•ã‚Œã¾ã™');
  } catch (e) {
    console.warn('Firebaseãƒªã‚¹ãƒŠãƒ¼è¨­å®šã‚¨ãƒ©ãƒ¼:', e);
  }
}

// ãƒªã‚»ãƒƒãƒˆå‡¦ç†ã‚‚Firebaseã«ä¿å­˜
function syncResetToFirebase() {
  if (typeof isFirebaseConnected !== 'function' || !isFirebaseConnected()) return;

  try {
    var db = getDatabase();
    var today = new Date().toDateString();
    db.ref('settings/lastReset').set(today);
  } catch (e) {
    console.warn('Firebaseãƒªã‚»ãƒƒãƒˆåŒæœŸã‚¨ãƒ©ãƒ¼:', e);
  }
}

// ãƒ‡ãƒãƒƒã‚°: ç¤¾å“¡ã®TYPEã‚’ç¢ºèª
function debugEmployeeTypes() {
  var employees = getEmployees();
  var info = 'ğŸ” ç¾åœ¨ã®ç¤¾å“¡TYPEè©³ç´°\n\n';
  info += 'å·¥å ´: ' + factoryNames[currentTab] + '\n';
  info += 'ç¤¾å“¡æ•°: ' + employees.length + 'å\n\n';

  var permanentCount = 0;
  var temporaryCount = 0;
  var noTypeCount = 0;

  for (var i = 0; i < employees.length; i++) {
    var emp = employees[i];
    info += '--- ç¤¾å“¡ ' + (i + 1) + ' ---\n';
    info += 'åå‰: ' + emp.name + '\n';
    info += 'ID: ' + emp.id + '\n';
    info += 'TYPE: ' + (emp.type || 'ãªã—') + '\n';
    info += 'ãƒã‚§ãƒƒã‚¯: ' + (emp.checked ? 'ON' : 'OFF') + '\n\n';

    if (emp.type === 'permanent') {
      permanentCount++;
    } else if (emp.type === 'temporary') {
      temporaryCount++;
    } else {
      noTypeCount++;
    }
  }

  info += '--- é›†è¨ˆ ---\n';
  info += 'ğŸ“˜ è¿½åŠ ãƒœã‚¿ãƒ³ (permanent): ' + permanentCount + 'å\n';
  info += 'ğŸŸ¡ å†ä½¿ç”¨ãƒœã‚¿ãƒ³ (temporary): ' + temporaryCount + 'å\n';
  info += 'â“ TYPEãªã—: ' + noTypeCount + 'å\n\n';

  if (noTypeCount > 0) {
    info += 'âš ï¸ TYPEãŒè¨­å®šã•ã‚Œã¦ã„ãªã„ç¤¾å“¡ãŒã„ã¾ã™ï¼\n';
    info += 'ã“ã‚Œã‚‰ã®ç¤¾å“¡ã¯ãƒªã‚»ãƒƒãƒˆæ™‚ã«å‰Šé™¤ã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚\n';
  }

  console.log(info);
  alert(info);
}

// ============================================
// Activity History (æ“ä½œå±¥æ­´è¨˜éŒ²)
// ============================================
function saveActivityLog(type, employeeName, employeeType, additionalInfo) {
  var history = JSON.parse(localStorage.getItem('heater-activity-history') || '[]');

  var activity = {
    timestamp: new Date().toISOString(),
    type: type, // 'add', 'delete', 'check', 'uncheck', 'reset'
    factory: currentTab,
    factoryName: factoryNames[currentTab],
    employeeName: employeeName || '',
    employeeType: employeeType || '',
    additionalInfo: additionalInfo || {}
  };

  history.unshift(activity);

  // æœ€æ–°500ä»¶ã®ã¿ä¿æŒ
  if (history.length > 500) {
    history.length = 500;
  }

  localStorage.setItem('heater-activity-history', JSON.stringify(history));
  console.log('ğŸ“ å±¥æ­´è¨˜éŒ²:', activity);

  // ã‚«ã‚¹ã‚¿ãƒ ã‚¤ãƒ™ãƒ³ãƒˆã‚’ç™ºç«ã—ã¦å³åº§ã«ç®¡ç†ç”»é¢ã«é€šçŸ¥
  window.dispatchEvent(new Event('activityUpdated'));
}

// ãƒ‡ãƒãƒƒã‚°: ãƒªã‚»ãƒƒãƒˆæ©Ÿèƒ½ã‚’ãƒ†ã‚¹ãƒˆï¼ˆå®Ÿéš›ã«ã¯ãƒªã‚»ãƒƒãƒˆã—ãªã„ï¼‰
function testResetFunction() {
  var employees = getEmployees();
  var info = 'ğŸ§ª ãƒªã‚»ãƒƒãƒˆå‹•ä½œã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³\n\n';
  info += 'å·¥å ´: ' + factoryNames[currentTab] + '\n';
  info += 'ç¾åœ¨ã®ç¤¾å“¡æ•°: ' + employees.length + 'å\n\n';

  var willKeep = [];
  var willDelete = [];

  for (var i = 0; i < employees.length; i++) {
    var emp = employees[i];
    if (emp.type === 'temporary') {
      willDelete.push(emp);
    } else {
      willKeep.push(emp);
    }
  }

  info += '--- ãƒªã‚»ãƒƒãƒˆå¾Œã®çŠ¶æ…‹ï¼ˆäºˆæ¸¬ï¼‰ ---\n\n';
  info += 'âœ… ç¶­æŒã•ã‚Œã‚‹ç¤¾å“¡: ' + willKeep.length + 'å\n';
  for (var i = 0; i < willKeep.length; i++) {
    info += '  - ' + willKeep[i].name + ' [' + (willKeep[i].type || 'TYPEæœªè¨­å®š') + ']\n';
  }

  info += '\nğŸ—‘ï¸ å‰Šé™¤ã•ã‚Œã‚‹ç¤¾å“¡: ' + willDelete.length + 'å\n';
  for (var i = 0; i < willDelete.length; i++) {
    info += '  - ' + willDelete[i].name + ' [' + willDelete[i].type + ']\n';
  }

  info += '\nâ€» ã“ã‚Œã¯ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§ã™ã€‚å®Ÿéš›ã®ãƒ‡ãƒ¼ã‚¿ã¯å¤‰æ›´ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚';

  console.log(info);
  alert(info);
}
</script>
</body>
</html>