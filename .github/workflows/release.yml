name: Create Release

on:
  push:
    tags:
      - 'v*'

permissions:
  contents: write

jobs:
  build-and-release:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Install dependencies
        run: npm ci

      - name: Build distribution package
        run: npm run build

      - name: Create ZIP package
        run: |
          cd dist
          zip -r ../heater-shutdown-checker-${GITHUB_REF#refs/tags/}.zip .
          cd ..

      - name: Extract version
        id: extract_version
        run: echo "VERSION=${GITHUB_REF#refs/tags/v}" >> $GITHUB_OUTPUT

      - name: Create Release Notes
        id: release_notes
        run: |
          cat > RELEASE_NOTES.md << 'EOF'
          ## ðŸ”¥ ç¯æ²¹ã‚¹ãƒˆãƒ¼ãƒ–æ¶ˆç«ç¢ºèªã‚¢ãƒ—ãƒª v${{ steps.extract_version.outputs.VERSION }}

          ### ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰

          ZIPãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦è§£å‡ã—ã€`index.html`ã‚’ãƒ–ãƒ©ã‚¦ã‚¶ã§é–‹ã„ã¦ãã ã•ã„ã€‚

          ### ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ–¹æ³•

          è©³ç´°ã¯ `INSTALL.md` ã‚’ã”ç¢ºèªãã ã•ã„ã€‚

          - **ã‚¹ãƒžãƒ¼ãƒˆãƒ•ã‚©ãƒ³**: PWAã¨ã—ã¦ãƒ›ãƒ¼ãƒ ç”»é¢ã«è¿½åŠ å¯èƒ½
          - **ãƒ‘ã‚½ã‚³ãƒ³**: ZIPã‚’è§£å‡ã—ã¦`index.html`ã‚’é–‹ã
          - **ã‚ªãƒ³ãƒ©ã‚¤ãƒ³**: https://ryoma373639.github.io/heater-shutdown-checker/

          ### ä¸»ãªæ©Ÿèƒ½

          - ðŸ“± PWAå¯¾å¿œï¼ˆã‚ªãƒ•ãƒ©ã‚¤ãƒ³å‹•ä½œï¼‰
          - ðŸ­ 4å·¥å ´å¯¾å¿œ
          - âœ… æ¶ˆç«ç¢ºèªãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ
          - ðŸ”„ æ¯Žæ—¥AM3æ™‚è‡ªå‹•ãƒªã‚»ãƒƒãƒˆ
          - ðŸ’¾ localStorageã§ãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ–

          ### å«ã¾ã‚Œã‚‹ãƒ•ã‚¡ã‚¤ãƒ«

          - `index.html` - ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒª
          - `manifest.json` - PWAãƒžãƒ‹ãƒ•ã‚§ã‚¹ãƒˆ
          - `sw.js` - Service Worker
          - `assets/` - ã‚¢ã‚¤ã‚³ãƒ³ç­‰
          - `README.md` - èª¬æ˜Žæ›¸
          - `INSTALL.md` - ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ‰‹é †
          - `USER_GUIDE.md` - ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¬ã‚¤ãƒ‰
          - `LICENSE` - ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

          ### å‹•ä½œç’°å¢ƒ

          - **ãƒ–ãƒ©ã‚¦ã‚¶**: Chrome, Edge, Firefox, Safariï¼ˆæœ€æ–°ç‰ˆï¼‰
          - **OS**: Windows 10ä»¥é™, macOS 10.12ä»¥é™, iOS 11.3ä»¥é™, Android 5.0ä»¥é™

          ---

          ðŸ¤– Built with [Miyabi](https://miyabi.app)
          EOF

      - name: Create Release
        uses: softprops/action-gh-release@v1
        with:
          files: heater-shutdown-checker-*.zip
          body_path: RELEASE_NOTES.md
          draft: false
          prerelease: false
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
